<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF 뷰어</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #2c2c2c;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        #viewer {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            gap: 2px;
        }

        .page-container {
            background: white;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            max-height: 100vh;
            max-width: 100%;
        }

        .click-area {
            position: fixed;
            top: 0;
            bottom: 0;
            width: 50%;
            cursor: pointer;
            z-index: 10;
        }

        #left-area {
            left: 0;
        }

        #right-area {
            right: 0;
        }

        #file-input {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }
    </style>
</head>
<body>
    <input type="file" id="file-input" accept=".pdf">
    <div id="viewer"></div>
    <div id="left-area" class="click-area" style="display: none;"></div>
    <div id="right-area" class="click-area" style="display: none;"></div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfDoc = null;
        let currentPage = 1;

        const fileInput = document.getElementById('file-input');
        const viewer = document.getElementById('viewer');
        const leftArea = document.getElementById('left-area');
        const rightArea = document.getElementById('right-area');

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const arrayBuffer = await file.arrayBuffer();
            pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            
            fileInput.style.display = 'none';
            leftArea.style.display = 'block';
            rightArea.style.display = 'block';
            
            renderPages();
        });

        leftArea.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage -= 2;
                if (currentPage < 1) currentPage = 1;
                renderPages();
            }
        });

        rightArea.addEventListener('click', () => {
            if (currentPage < pdfDoc.numPages) {
                currentPage += 2;
                renderPages();
            }
        });

        async function renderPages() {
            viewer.innerHTML = '';

            const viewportHeight = window.innerHeight;
            const viewportWidth = window.innerWidth / 2 - 1;

            // 왼쪽 페이지
            if (currentPage <= pdfDoc.numPages) {
                await renderPage(currentPage, viewportWidth, viewportHeight);
            }

            // 오른쪽 페이지
            if (currentPage + 1 <= pdfDoc.numPages) {
                await renderPage(currentPage + 1, viewportWidth, viewportHeight);
            }
        }

        async function renderPage(pageNum, maxWidth, maxHeight) {
            const page = await pdfDoc.getPage(pageNum);
            
            // 페이지 크기에 맞는 scale 계산
            let viewport = page.getViewport({ scale: 1.0 });
            const scaleWidth = maxWidth / viewport.width;
            const scaleHeight = maxHeight / viewport.height;
            const scale = Math.min(scaleWidth, scaleHeight);
            
            viewport = page.getViewport({ scale: scale });

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const container = document.createElement('div');
            container.className = 'page-container';
            container.appendChild(canvas);
            viewer.appendChild(container);

            await page.render({
                canvasContext: context,
                viewport: viewport
            }).promise;
        }

        // 키보드 네비게이션
        document.addEventListener('keydown', (e) => {
            if (!pdfDoc) return;
            
            if (e.key === 'ArrowLeft' && currentPage > 1) {
                currentPage -= 2;
                if (currentPage < 1) currentPage = 1;
                renderPages();
            } else if (e.key === 'ArrowRight' && currentPage < pdfDoc.numPages) {
                currentPage += 2;
                renderPages();
            }
        });
    </script>
</body>
</html>

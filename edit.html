<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ê¸‰ í…ìŠ¤íŠ¸ í¸ì§‘ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100dvh;
            width: 100vw;
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        #app {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        /* íˆ´ë°” */
        .toolbar {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            padding: 8px 12px;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            gap: 4px;
            padding: 0 8px;
            border-right: 1px solid #3e3e42;
        }

        .toolbar-group:last-child {
            border-right: none;
            margin-left: auto;
        }

        button, select {
            background: #3e3e42;
            color: #d4d4d4;
            border: 1px solid #555;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        button:hover, select:hover {
            background: #505053;
            border-color: #777;
        }

        button:active {
            background: #2d2d30;
        }

        button.active {
            background: #0e639c;
            border-color: #1177bb;
        }

        select {
            padding: 5px 8px;
        }

        input[type="number"] {
            width: 60px;
            background: #3e3e42;
            color: #d4d4d4;
            border: 1px solid #555;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 13px;
        }

        input[type="color"] {
            width: 40px;
            height: 32px;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            background: #3e3e42;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        /* ì‚¬ì´ë“œë°” - íŒŒì¼ ëª©ë¡ */
        .sidebar {
            width: 250px;
            min-width: 250px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 12px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .file-item {
            padding: 8px 12px;
            margin: 2px 0;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
            font-size: 13px;
        }

        .file-item:hover {
            background: #2d2d30;
        }

        .file-item.active {
            background: #094771;
        }

        .file-item.modified::after {
            content: 'â—';
            color: #ffa500;
            margin-left: 8px;
        }

        .file-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .close-file {
            background: none;
            border: none;
            color: #888;
            padding: 2px 6px;
            font-size: 16px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
        }

        .file-item:hover .close-file {
            opacity: 1;
        }

        .close-file:hover {
            color: #d4d4d4;
            background: #555;
            border-radius: 3px;
        }

        /* ì—ë””í„° ì˜ì—­ */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 0;
        }

        .tabs {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            overflow-x: auto;
            padding: 0 8px;
            flex-shrink: 0;
        }

        .tab {
            padding: 10px 16px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            font-size: 13px;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #383838;
        }

        .tab.active {
            background: #1e1e1e;
            border-bottom-color: #0e639c;
        }

        .tab.modified .tab-name::after {
            content: 'â—';
            color: #ffa500;
            margin-left: 6px;
        }

        .tab-close {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            padding: 2px 4px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .tab-close:hover {
            color: #d4d4d4;
            background: #555;
            border-radius: 3px;
        }

        .editor-wrapper {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
            width: 100%;
            min-height: 0;
        }

        /* ë¼ì¸ ë„˜ë²„ */
        .line-numbers {
            background: #1e1e1e;
            color: #858585;
            padding: 12px 8px;
            text-align: right;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            user-select: none;
            border-right: 1px solid #3e3e42;
            overflow: hidden;
            min-width: 50px;
            white-space: pre;
            word-wrap: normal;
            overflow-wrap: normal;
        }

        .editor {
            flex: 1;
            padding: 12px;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            border: none;
            outline: none;
            resize: none;
            overflow-y: auto;
            white-space: pre;
            overflow-wrap: normal;
            tab-size: 4;
        }

        /* ìƒíƒœë°” */
        .statusbar {
            background: #007acc;
            color: white;
            padding: 6px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            flex-shrink: 0;
        }

        .statusbar-left, .statusbar-right {
            display: flex;
            gap: 16px;
        }

        /* ê²€ìƒ‰/ë°”ê¾¸ê¸° íŒ¨ë„ */
        .search-panel {
            background: #252526;
            border-bottom: 1px solid #3e3e42;
            padding: 12px;
            display: none;
            flex-direction: column;
            gap: 8px;
        }

        .search-panel.active {
            display: flex;
        }

        .search-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            background: #3c3c3c;
            color: #d4d4d4;
            border: 1px solid #555;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 13px;
        }

        .search-input:focus {
            outline: none;
            border-color: #0e639c;
        }

        /* ì„¤ì • íŒ¨ë„ */
        .settings-panel {
            position: absolute;
            top: 50px;
            right: 20px;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            padding: 16px;
            display: none;
            flex-direction: column;
            gap: 12px;
            min-width: 300px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .settings-panel.active {
            display: flex;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .setting-label {
            font-size: 13px;
        }

        /* ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ */
        .context-menu {
            position: absolute;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 4px 0;
            display: none;
            z-index: 2000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            min-width: 180px;
        }

        .context-menu.active {
            display: block;
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .context-menu-item:hover {
            background: #094771;
        }

        .context-menu-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .context-menu-item.disabled:hover {
            background: transparent;
        }

        .shortcut {
            color: #888;
            font-size: 11px;
            margin-left: 16px;
        }

        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í„°ë§ˆì´ì§• */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #424242;
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4e4e4e;
        }

        /* í™˜ì˜ í™”ë©´ */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            color: #888;
            font-size: 14px;
            gap: 20px;
        }

        .welcome-screen h2 {
            font-size: 24px;
            color: #d4d4d4;
        }

        .welcome-actions {
            display: flex;
            gap: 12px;
        }

        /* í†µê³„ íŒ¨ë„ */
        .stats-panel {
            position: absolute;
            bottom: 40px;
            right: 20px;
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            padding: 16px;
            display: none;
            flex-direction: column;
            gap: 8px;
            min-width: 250px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .stats-panel.active {
            display: flex;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .stats-label {
            color: #888;
        }

        .stats-value {
            color: #d4d4d4;
            font-weight: bold;
        }

        /* ë¡œë”© ì¸ë””ì¼€ì´í„° */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #888;
            font-size: 14px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .toolbar-group {
                padding: 0 4px;
            }
            
            button, select {
                padding: 4px 8px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- íˆ´ë°” -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button onclick="editor.newFile()" title="ìƒˆ íŒŒì¼ (Ctrl+N)">ğŸ“„ ìƒˆ íŒŒì¼</button>
                <button onclick="editor.openFile()" title="íŒŒì¼ ì—´ê¸° (Ctrl+O)">ğŸ“ ì—´ê¸°</button>
                <button onclick="editor.openMultipleFiles()" title="ì—¬ëŸ¬ íŒŒì¼ ì—´ê¸°">ğŸ“‚ ë‹¤ì¤‘ ì—´ê¸°</button>
                <button onclick="editor.openFolder()" title="í´ë” ì—´ê¸°">ğŸ“‚ í´ë”</button>
                <button onclick="editor.saveFile()" title="ì €ì¥ (Ctrl+S)">ğŸ’¾ ì €ì¥</button>
                <button onclick="editor.saveAs()" title="ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥ (Ctrl+Shift+S)">ğŸ’¾ ë‹¤ë¥¸ ì´ë¦„</button>
                <button onclick="editor.saveAll()" title="ëª¨ë‘ ì €ì¥">ğŸ’¾ ëª¨ë‘ ì €ì¥</button>
            </div>
            
            <div class="toolbar-group">
                <button onclick="editor.undo()" title="ì‹¤í–‰ ì·¨ì†Œ (Ctrl+Z)">â†¶</button>
                <button onclick="editor.redo()" title="ë‹¤ì‹œ ì‹¤í–‰ (Ctrl+Y)">â†·</button>
            </div>
            
            <div class="toolbar-group">
                <button onclick="editor.cut()" title="ì˜ë¼ë‚´ê¸° (Ctrl+X)">âœ‚ï¸</button>
                <button onclick="editor.copy()" title="ë³µì‚¬ (Ctrl+C)">ğŸ“‹</button>
                <button onclick="editor.paste()" title="ë¶™ì—¬ë„£ê¸° (Ctrl+V)">ğŸ“„</button>
                <button onclick="editor.selectAll()" title="ëª¨ë‘ ì„ íƒ (Ctrl+A)">â¬š</button>
            </div>
            
            <div class="toolbar-group">
                <button id="boldBtn" onclick="editor.formatText('bold')" title="êµµê²Œ (Ctrl+B)"><b>B</b></button>
                <button id="italicBtn" onclick="editor.formatText('italic')" title="ê¸°ìš¸ì„ (Ctrl+I)"><i>I</i></button>
                <button id="underlineBtn" onclick="editor.formatText('underline')" title="ë°‘ì¤„ (Ctrl+U)"><u>U</u></button>
                <select onchange="editor.changeFontSize(this.value)">
                    <option value="12">12px</option>
                    <option value="14" selected>14px</option>
                    <option value="16">16px</option>
                    <option value="18">18px</option>
                    <option value="20">20px</option>
                    <option value="24">24px</option>
                </select>
            </div>
            
            <div class="toolbar-group">
                <button onclick="editor.toggleSearch()" title="ì°¾ê¸° (Ctrl+F)">ğŸ” ì°¾ê¸°</button>
                <button onclick="editor.toggleReplace()" title="ë°”ê¾¸ê¸° (Ctrl+H)">ğŸ”„ ë°”ê¾¸ê¸°</button>
                <button onclick="editor.gotoLine()" title="ì¤„ ì´ë™ (Ctrl+G)">â¡ï¸ ì¤„ ì´ë™</button>
            </div>
            
            <div class="toolbar-group">
                <button onclick="editor.indent()" title="ë“¤ì—¬ì“°ê¸° (Tab)">â†’</button>
                <button onclick="editor.outdent()" title="ë‚´ì–´ì“°ê¸° (Shift+Tab)">â†</button>
                <button onclick="editor.duplicateLine()" title="ì¤„ ë³µì œ (Ctrl+D)">â˜</button>
                <button onclick="editor.deleteLine()" title="ì¤„ ì‚­ì œ (Ctrl+Shift+K)">ğŸ—‘ï¸</button>
                <button onclick="editor.moveLinesUp()" title="ì¤„ ìœ„ë¡œ (Alt+â†‘)">â†‘</button>
                <button onclick="editor.moveLinesDown()" title="ì¤„ ì•„ë˜ë¡œ (Alt+â†“)">â†“</button>
            </div>
            
            <div class="toolbar-group">
                <button onclick="editor.toggleStats()" title="í†µê³„">ğŸ“Š</button>
                <button onclick="editor.toggleSettings()" title="ì„¤ì •">âš™ï¸</button>
            </div>
        </div>

        <!-- ê²€ìƒ‰/ë°”ê¾¸ê¸° íŒ¨ë„ -->
        <div class="search-panel" id="searchPanel">
            <div class="search-row">
                <input type="text" class="search-input" id="searchInput" placeholder="ì°¾ê¸°...">
                <button onclick="editor.findNext()">ë‹¤ìŒ (F3)</button>
                <button onclick="editor.findPrevious()">ì´ì „ (Shift+F3)</button>
                <label><input type="checkbox" id="caseSensitive"> ëŒ€ì†Œë¬¸ì êµ¬ë¶„</label>
                <label><input type="checkbox" id="useRegex"> ì •ê·œì‹</label>
                <button onclick="editor.toggleSearch()">âœ•</button>
            </div>
            <div class="search-row" id="replaceRow" style="display: none;">
                <input type="text" class="search-input" id="replaceInput" placeholder="ë°”ê¿€ ë‚´ìš©...">
                <button onclick="editor.replace()">ë°”ê¾¸ê¸°</button>
                <button onclick="editor.replaceAll()">ëª¨ë‘ ë°”ê¾¸ê¸°</button>
            </div>
        </div>

        <div class="main-container">
            <!-- ì‚¬ì´ë“œë°” -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <span>ì—´ë¦° íŒŒì¼</span>
                    <button onclick="editor.closeAll()" style="padding: 4px 8px; font-size: 12px;">ëª¨ë‘ ë‹«ê¸°</button>
                </div>
                <div class="file-list" id="fileList"></div>
            </div>

            <!-- ì—ë””í„° ì˜ì—­ -->
            <div class="editor-container">
                <div class="tabs" id="tabs"></div>
                <div class="editor-wrapper" id="editorWrapper">
                    <div class="welcome-screen">
                        <h2>ê³ ê¸‰ í…ìŠ¤íŠ¸ í¸ì§‘ê¸°</h2>
                        <p>íŒŒì¼ì„ ì—´ì–´ í¸ì§‘ì„ ì‹œì‘í•˜ì„¸ìš”</p>
                        <div class="welcome-actions">
                            <button onclick="editor.openFile()">ğŸ“ íŒŒì¼ ì—´ê¸°</button>
                            <button onclick="editor.openMultipleFiles()">ğŸ“‚ ì—¬ëŸ¬ íŒŒì¼ ì—´ê¸°</button>
                            <button onclick="editor.openFolder()">ğŸ“‚ í´ë” ì—´ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìƒíƒœë°” -->
        <div class="statusbar">
            <div class="statusbar-left">
                <span id="fileInfo">íŒŒì¼ ì—†ìŒ</span>
                <span id="encoding">UTF-8</span>
            </div>
            <div class="statusbar-right">
                <span id="cursorPosition">ì¤„ 0, ì—´ 0</span>
                <span id="selection">ì„ íƒ 0</span>
                <span id="fileSize">0 bytes</span>
            </div>
        </div>

        <!-- ì„¤ì • íŒ¨ë„ -->
        <div class="settings-panel" id="settingsPanel">
            <h3>ì„¤ì •</h3>
            <div class="setting-item">
                <span class="setting-label">ì¤„ ë²ˆí˜¸ í‘œì‹œ</span>
                <input type="checkbox" id="showLineNumbers" checked onchange="editor.updateSettings()">
            </div>
            <div class="setting-item">
                <span class="setting-label">ìë™ ì €ì¥</span>
                <input type="checkbox" id="autoSave" onchange="editor.updateSettings()">
            </div>
            <div class="setting-item">
                <span class="setting-label">íƒ­ í¬ê¸°</span>
                <input type="number" id="tabSize" value="4" min="1" max="8" onchange="editor.updateSettings()">
            </div>
            <div class="setting-item">
                <span class="setting-label">ìë™ ì¤„ ë°”ê¿ˆ</span>
                <input type="checkbox" id="wordWrap" onchange="editor.updateSettings()">
            </div>
            <div class="setting-item">
                <span class="setting-label">í…Œë§ˆ</span>
                <select id="theme" onchange="editor.changeTheme(this.value)">
                    <option value="dark" selected>Dark</option>
                    <option value="light">Light</option>
                </select>
            </div>
        </div>

        <!-- í†µê³„ íŒ¨ë„ -->
        <div class="stats-panel" id="statsPanel">
            <h3>ë¬¸ì„œ í†µê³„</h3>
            <div class="stats-item">
                <span class="stats-label">ë¬¸ì ìˆ˜:</span>
                <span class="stats-value" id="charCount">0</span>
            </div>
            <div class="stats-item">
                <span class="stats-label">ê³µë°± ì œì™¸:</span>
                <span class="stats-value" id="charNoSpace">0</span>
            </div>
            <div class="stats-item">
                <span class="stats-label">ë‹¨ì–´ ìˆ˜:</span>
                <span class="stats-value" id="wordCount">0</span>
            </div>
            <div class="stats-item">
                <span class="stats-label">ì¤„ ìˆ˜:</span>
                <span class="stats-value" id="lineCount">0</span>
            </div>
            <div class="stats-item">
                <span class="stats-label">ì„ íƒëœ ë¬¸ì:</span>
                <span class="stats-value" id="selectedChars">0</span>
            </div>
        </div>

        <!-- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ -->
        <div class="context-menu" id="contextMenu">
            <div class="context-menu-item" onclick="editor.cut()">
                ì˜ë¼ë‚´ê¸° <span class="shortcut">Ctrl+X</span>
            </div>
            <div class="context-menu-item" onclick="editor.copy()">
                ë³µì‚¬ <span class="shortcut">Ctrl+C</span>
            </div>
            <div class="context-menu-item" onclick="editor.paste()">
                ë¶™ì—¬ë„£ê¸° <span class="shortcut">Ctrl+V</span>
            </div>
            <div class="context-menu-item" onclick="editor.selectAll()">
                ëª¨ë‘ ì„ íƒ <span class="shortcut">Ctrl+A</span>
            </div>
            <hr style="margin: 4px 0; border: none; border-top: 1px solid #3e3e42;">
            <div class="context-menu-item" onclick="editor.undo()">
                ì‹¤í–‰ ì·¨ì†Œ <span class="shortcut">Ctrl+Z</span>
            </div>
            <div class="context-menu-item" onclick="editor.redo()">
                ë‹¤ì‹œ ì‹¤í–‰ <span class="shortcut">Ctrl+Y</span>
            </div>
            <hr style="margin: 4px 0; border: none; border-top: 1px solid #3e3e42;">
            <div class="context-menu-item" onclick="editor.duplicateLine()">
                ì¤„ ë³µì œ <span class="shortcut">Ctrl+D</span>
            </div>
            <div class="context-menu-item" onclick="editor.deleteLine()">
                ì¤„ ì‚­ì œ <span class="shortcut">Ctrl+Shift+K</span>
            </div>
        </div>
    </div>

    <script>
        class TextEditor {
            constructor() {
                this.files = [];
                this.currentFileIndex = -1;
                this.undoStack = new Map();
                this.redoStack = new Map();
                this.searchResults = [];
                this.currentSearchIndex = -1;
                this.autoSaveInterval = null;
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.checkFileSystemSupport();
            }

            checkFileSystemSupport() {
                if (!('showOpenFilePicker' in window)) {
                    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” File System Access APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome, Edge ë“± ìµœì‹  ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                }
            }

            setupEventListeners() {
                // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key.toLowerCase()) {
                            case 'n':
                                e.preventDefault();
                                this.newFile();
                                break;
                            case 'o':
                                e.preventDefault();
                                this.openFile();
                                break;
                            case 's':
                                e.preventDefault();
                                if (e.shiftKey) {
                                    this.saveAs();
                                } else {
                                    this.saveFile();
                                }
                                break;
                            case 'f':
                                e.preventDefault();
                                this.toggleSearch();
                                break;
                            case 'h':
                                e.preventDefault();
                                this.toggleReplace();
                                break;
                            case 'g':
                                e.preventDefault();
                                this.gotoLine();
                                break;
                            case 'd':
                                e.preventDefault();
                                this.duplicateLine();
                                break;
                            case 'z':
                                e.preventDefault();
                                this.undo();
                                break;
                            case 'y':
                                e.preventDefault();
                                this.redo();
                                break;
                        }
                        
                        if (e.shiftKey && e.key.toLowerCase() === 'k') {
                            e.preventDefault();
                            this.deleteLine();
                        }
                    }
                    
                    if (e.altKey) {
                        if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            this.moveLinesUp();
                        } else if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            this.moveLinesDown();
                        }
                    }
                    
                    if (e.key === 'F3') {
                        e.preventDefault();
                        if (e.shiftKey) {
                            this.findPrevious();
                        } else {
                            this.findNext();
                        }
                    }
                    
                    if (e.key === 'Tab') {
                        e.preventDefault();
                        if (e.shiftKey) {
                            this.outdent();
                        } else {
                            this.indent();
                        }
                    }
                });

                // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´
                document.addEventListener('contextmenu', (e) => {
                    const target = e.target;
                    if (target.classList.contains('editor')) {
                        e.preventDefault();
                        this.showContextMenu(e.clientX, e.clientY);
                    }
                });

                document.addEventListener('click', () => {
                    this.hideContextMenu();
                    document.getElementById('settingsPanel').classList.remove('active');
                    document.getElementById('statsPanel').classList.remove('active');
                });

                // ë“œë˜ê·¸ ì•¤ ë“œë¡­
                const editorWrapper = document.getElementById('editorWrapper');
                editorWrapper.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                });

                editorWrapper.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const files = Array.from(e.dataTransfer.files);
                    for (const file of files) {
                        if (file.type.startsWith('text/') || file.name.match(/\.(txt|js|html|css|json|md|xml|csv)$/i)) {
                            await this.loadDroppedFile(file);
                        }
                    }
                });

                // í˜ì´ì§€ ë– ë‚  ë•Œ ê²½ê³ 
                window.addEventListener('beforeunload', (e) => {
                    const hasUnsaved = this.files.some(f => f.modified);
                    if (hasUnsaved) {
                        e.preventDefault();
                        e.returnValue = '';
                    }
                });
            }

            newFile() {
                const fileName = prompt('ìƒˆ íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', 'untitled.txt');
                if (!fileName) return;

                const fileData = {
                    handle: null,
                    name: fileName,
                    content: '',
                    originalContent: '',
                    modified: false,
                    size: 0,
                    cursorPosition: 0,
                    scrollTop: 0
                };

                this.files.push(fileData);
                this.undoStack.set(this.files.length - 1, []);
                this.redoStack.set(this.files.length - 1, []);
                
                this.currentFileIndex = this.files.length - 1;
                this.renderUI();
                this.updateStatusBar();
                
                // ì—ë””í„°ì— í¬ì»¤ìŠ¤
                setTimeout(() => {
                    const editorEl = document.getElementById('editor');
                    if (editorEl) editorEl.focus();
                }, 100);
            }

            async openFile() {
                try {
                    const [fileHandle] = await window.showOpenFilePicker({
                        types: [
                            {
                                description: 'í…ìŠ¤íŠ¸ íŒŒì¼',
                                accept: {
                                    'text/*': ['.txt', '.js', '.html', '.css', '.json', '.md', '.xml', '.csv', '.py', '.java', '.cpp', '.c', '.h']
                                }
                            }
                        ],
                        multiple: false
                    });

                    await this.loadFile(fileHandle);
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        console.error('íŒŒì¼ ì—´ê¸° ì˜¤ë¥˜:', err);
                    }
                }
            }

            async openMultipleFiles() {
                try {
                    const fileHandles = await window.showOpenFilePicker({
                        types: [
                            {
                                description: 'í…ìŠ¤íŠ¸ íŒŒì¼',
                                accept: {
                                    'text/*': ['.txt', '.js', '.html', '.css', '.json', '.md', '.xml', '.csv', '.py', '.java', '.cpp', '.c', '.h']
                                }
                            }
                        ],
                        multiple: true
                    });

                    for (const fileHandle of fileHandles) {
                        await this.loadFile(fileHandle);
                    }
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        console.error('íŒŒì¼ ì—´ê¸° ì˜¤ë¥˜:', err);
                    }
                }
            }

            async openFolder() {
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    
                    for await (const entry of dirHandle.values()) {
                        if (entry.kind === 'file') {
                            const file = await entry.getFile();
                            if (file.type.startsWith('text/') || file.name.match(/\.(txt|js|html|css|json|md|xml|csv|py|java|cpp|c|h)$/i)) {
                                await this.loadFile(entry);
                            }
                        }
                    }
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        console.error('í´ë” ì—´ê¸° ì˜¤ë¥˜:', err);
                    }
                }
            }

            async loadFile(fileHandle) {
                const file = await fileHandle.getFile();
                const content = await file.text();
                
                // ì´ë¯¸ ì—´ë¦° íŒŒì¼ì¸ì§€ í™•ì¸
                const existingIndex = this.files.findIndex(f => f.handle === fileHandle);
                if (existingIndex !== -1) {
                    this.switchToFile(existingIndex);
                    return;
                }

                const fileData = {
                    handle: fileHandle,
                    name: file.name,
                    content: content,
                    originalContent: content,
                    modified: false,
                    size: file.size,
                    cursorPosition: 0,
                    scrollTop: 0
                };

                this.files.push(fileData);
                this.undoStack.set(this.files.length - 1, []);
                this.redoStack.set(this.files.length - 1, []);
                
                this.currentFileIndex = this.files.length - 1;
                this.renderUI();
                this.updateStatusBar();
            }

            async loadDroppedFile(file) {
                const content = await file.text();
                
                const fileData = {
                    handle: null,
                    name: file.name,
                    content: content,
                    originalContent: content,
                    modified: false,
                    size: file.size,
                    cursorPosition: 0,
                    scrollTop: 0
                };

                this.files.push(fileData);
                this.undoStack.set(this.files.length - 1, []);
                this.redoStack.set(this.files.length - 1, []);
                
                this.currentFileIndex = this.files.length - 1;
                this.renderUI();
                this.updateStatusBar();
            }

            renderUI() {
                this.renderTabs();
                this.renderFileList();
                this.renderEditor();
            }

            renderTabs() {
                const tabsContainer = document.getElementById('tabs');
                tabsContainer.innerHTML = '';

                this.files.forEach((file, index) => {
                    const tab = document.createElement('div');
                    tab.className = `tab ${index === this.currentFileIndex ? 'active' : ''} ${file.modified ? 'modified' : ''}`;
                    tab.innerHTML = `
                        <span class="tab-name">${file.name}</span>
                        <button class="tab-close" onclick="editor.closeFile(${index}, event)">âœ•</button>
                    `;
                    tab.onclick = (e) => {
                        if (!e.target.classList.contains('tab-close')) {
                            this.switchToFile(index);
                        }
                    };
                    tabsContainer.appendChild(tab);
                });
            }

            renderFileList() {
                const fileList = document.getElementById('fileList');
                fileList.innerHTML = '';

                this.files.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = `file-item ${index === this.currentFileIndex ? 'active' : ''} ${file.modified ? 'modified' : ''}`;
                    item.innerHTML = `
                        <span class="file-name" title="${file.name}">${file.name}</span>
                        <button class="close-file" onclick="editor.closeFile(${index}, event)">âœ•</button>
                    `;
                    item.onclick = (e) => {
                        if (!e.target.classList.contains('close-file')) {
                            this.switchToFile(index);
                        }
                    };
                    fileList.appendChild(item);
                });
            }

            renderEditor() {
                const wrapper = document.getElementById('editorWrapper');
                
                if (this.currentFileIndex === -1) {
                    wrapper.innerHTML = `
                        <div class="welcome-screen">
                            <h2>ê³ ê¸‰ í…ìŠ¤íŠ¸ í¸ì§‘ê¸°</h2>
                            <p>íŒŒì¼ì„ ì—´ì–´ í¸ì§‘ì„ ì‹œì‘í•˜ì„¸ìš”</p>
                            <div class="welcome-actions">
                                <button onclick="editor.newFile()">ğŸ“„ ìƒˆ íŒŒì¼</button>
                                <button onclick="editor.openFile()">ğŸ“ íŒŒì¼ ì—´ê¸°</button>
                                <button onclick="editor.openMultipleFiles()">ğŸ“‚ ì—¬ëŸ¬ íŒŒì¼ ì—´ê¸°</button>
                                <button onclick="editor.openFolder()">ğŸ“‚ í´ë” ì—´ê¸°</button>
                            </div>
                        </div>
                    `;
                    return;
                }

                const file = this.files[this.currentFileIndex];
                const lines = file.content.split('\n');
                
                wrapper.innerHTML = `
                    <div class="line-numbers" id="lineNumbers"></div>
                    <textarea class="editor" id="editor" spellcheck="false"></textarea>
                `;

                const editorEl = document.getElementById('editor');
                editorEl.value = file.content;
                
                this.updateLineNumbers();
                
                editorEl.addEventListener('input', (e) => {
                    this.handleInput(e);
                });

                editorEl.addEventListener('scroll', () => {
                    const lineNumbers = document.getElementById('lineNumbers');
                    if (lineNumbers) {
                        lineNumbers.scrollTop = editorEl.scrollTop;
                    }
                });

                editorEl.addEventListener('keyup', () => {
                    this.updateCursorPosition();
                    this.updateStats();
                });

                editorEl.addEventListener('click', () => {
                    this.updateCursorPosition();
                    this.updateStats();
                });

                editorEl.addEventListener('select', () => {
                    this.updateStats();
                });

                // ì €ì¥ëœ ì»¤ì„œ ìœ„ì¹˜ì™€ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›
                setTimeout(() => {
                    editorEl.setSelectionRange(file.cursorPosition, file.cursorPosition);
                    editorEl.scrollTop = file.scrollTop;
                    
                    const lineNumbers = document.getElementById('lineNumbers');
                    if (lineNumbers) {
                        lineNumbers.scrollTop = file.scrollTop;
                    }
                }, 0);

                editorEl.focus();
            }

            updateLineNumbers() {
                const editorEl = document.getElementById('editor');
                const lineNumbers = document.getElementById('lineNumbers');
                
                if (!editorEl || !lineNumbers) return;
                
                const lines = editorEl.value.split('\n');
                const lineCount = lines.length;
                
                // ê° ì‹¤ì œ ì¤„ì— ëŒ€í•´ ì¤„ ë²ˆí˜¸ë¥¼ ìƒì„± (ê¸´ ì¤„ì€ í•œ ì¤„ë¡œ ì·¨ê¸‰)
                const numbers = Array.from({length: lineCount}, (_, i) => i + 1).join('\n');
                lineNumbers.textContent = numbers;
                
                // ì¤„ ë²ˆí˜¸ ì»¨í…Œì´ë„ˆì˜ ë„ˆë¹„ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì •
                const maxDigits = lineCount.toString().length;
                lineNumbers.style.minWidth = (maxDigits * 10 + 16) + 'px';
            }

            handleInput(e) {
                if (this.currentFileIndex === -1) return;

                const file = this.files[this.currentFileIndex];
                const newContent = e.target.value;

                // Undo ìŠ¤íƒì— ì¶”ê°€
                const undoStack = this.undoStack.get(this.currentFileIndex);
                undoStack.push(file.content);
                if (undoStack.length > 100) {
                    undoStack.shift();
                }

                // Redo ìŠ¤íƒ ì´ˆê¸°í™”
                this.redoStack.set(this.currentFileIndex, []);

                file.content = newContent;
                file.modified = file.content !== file.originalContent;
                
                // ì»¤ì„œ ìœ„ì¹˜ ì €ì¥
                file.cursorPosition = e.target.selectionStart;

                this.updateLineNumbers();
                this.renderTabs();
                this.renderFileList();
                this.updateStatusBar();
                this.updateStats();

                // ìë™ ì €ì¥
                if (document.getElementById('autoSave').checked) {
                    clearTimeout(this.autoSaveTimeout);
                    this.autoSaveTimeout = setTimeout(() => {
                        this.saveFile();
                    }, 2000);
                }
            }

            switchToFile(index) {
                if (index < 0 || index >= this.files.length) return;
                
                // í˜„ì¬ íŒŒì¼ì˜ ì»¤ì„œ ìœ„ì¹˜ì™€ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
                if (this.currentFileIndex !== -1) {
                    const editorEl = document.getElementById('editor');
                    if (editorEl) {
                        this.files[this.currentFileIndex].cursorPosition = editorEl.selectionStart;
                        this.files[this.currentFileIndex].scrollTop = editorEl.scrollTop;
                    }
                }
                
                this.currentFileIndex = index;
                this.renderUI();
                this.updateStatusBar();
                this.updateStats();
            }

            async closeFile(index, event) {
                if (event) {
                    event.stopPropagation();
                }

                const file = this.files[index];
                
                if (file.modified) {
                    const confirm = window.confirm(`'${file.name}' íŒŒì¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì €ì¥í•˜ì§€ ì•Šê³  ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?`);
                    if (!confirm) return;
                }

                this.files.splice(index, 1);
                this.undoStack.delete(index);
                this.redoStack.delete(index);

                // ì¸ë±ìŠ¤ ì¬ì¡°ì •
                const newUndoStack = new Map();
                const newRedoStack = new Map();
                this.undoStack.forEach((value, key) => {
                    if (key < index) {
                        newUndoStack.set(key, value);
                    } else if (key > index) {
                        newUndoStack.set(key - 1, value);
                    }
                });
                this.redoStack.forEach((value, key) => {
                    if (key < index) {
                        newRedoStack.set(key, value);
                    } else if (key > index) {
                        newRedoStack.set(key - 1, value);
                    }
                });
                this.undoStack = newUndoStack;
                this.redoStack = newRedoStack;

                if (this.currentFileIndex === index) {
                    this.currentFileIndex = Math.min(index, this.files.length - 1);
                } else if (this.currentFileIndex > index) {
                    this.currentFileIndex--;
                }

                this.renderUI();
                this.updateStatusBar();
            }

            closeAll() {
                const hasUnsaved = this.files.some(f => f.modified);
                if (hasUnsaved) {
                    const confirm = window.confirm('ìˆ˜ì •ëœ íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤. ì €ì¥í•˜ì§€ ì•Šê³  ëª¨ë‘ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (!confirm) return;
                }

                this.files = [];
                this.currentFileIndex = -1;
                this.undoStack.clear();
                this.redoStack.clear();
                this.renderUI();
                this.updateStatusBar();
            }

            async saveFile() {
                if (this.currentFileIndex === -1) return;

                const file = this.files[this.currentFileIndex];
                
                try {
                    if (!file.handle) {
                        await this.saveAs();
                        return;
                    }

                    const writable = await file.handle.createWritable();
                    await writable.write(file.content);
                    await writable.close();

                    file.originalContent = file.content;
                    file.modified = false;
                    
                    this.renderTabs();
                    this.renderFileList();
                    this.updateStatusBar();
                    
                    this.showNotification('ì €ì¥ ì™„ë£Œ');
                } catch (err) {
                    console.error('ì €ì¥ ì˜¤ë¥˜:', err);
                    alert('íŒŒì¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }

            async saveAs() {
                if (this.currentFileIndex === -1) return;

                const file = this.files[this.currentFileIndex];
                
                try {
                    const fileHandle = await window.showSaveFilePicker({
                        suggestedName: file.name,
                        types: [
                            {
                                description: 'í…ìŠ¤íŠ¸ íŒŒì¼',
                                accept: {'text/plain': ['.txt']}
                            }
                        ]
                    });

                    const writable = await fileHandle.createWritable();
                    await writable.write(file.content);
                    await writable.close();

                    file.handle = fileHandle;
                    file.name = fileHandle.name;
                    file.originalContent = file.content;
                    file.modified = false;

                    this.renderUI();
                    this.updateStatusBar();
                    
                    this.showNotification('ì €ì¥ ì™„ë£Œ');
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        console.error('ì €ì¥ ì˜¤ë¥˜:', err);
                        alert('íŒŒì¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            }

            async saveAll() {
                for (let i = 0; i < this.files.length; i++) {
                    if (this.files[i].modified) {
                        const prevIndex = this.currentFileIndex;
                        this.currentFileIndex = i;
                        await this.saveFile();
                        this.currentFileIndex = prevIndex;
                    }
                }
                this.showNotification('ëª¨ë“  íŒŒì¼ ì €ì¥ ì™„ë£Œ');
            }

            undo() {
                if (this.currentFileIndex === -1) return;
                
                const undoStack = this.undoStack.get(this.currentFileIndex);
                if (undoStack.length === 0) return;

                const file = this.files[this.currentFileIndex];
                const redoStack = this.redoStack.get(this.currentFileIndex);
                
                redoStack.push(file.content);
                file.content = undoStack.pop();
                file.modified = file.content !== file.originalContent;

                const editorEl = document.getElementById('editor');
                if (editorEl) {
                    const scrollTop = editorEl.scrollTop;
                    editorEl.value = file.content;
                    editorEl.scrollTop = scrollTop;
                }

                this.updateLineNumbers();
                this.renderTabs();
                this.renderFileList();
                this.updateStatusBar();
            }

            redo() {
                if (this.currentFileIndex === -1) return;
                
                const redoStack = this.redoStack.get(this.currentFileIndex);
                if (redoStack.length === 0) return;

                const file = this.files[this.currentFileIndex];
                const undoStack = this.undoStack.get(this.currentFileIndex);
                
                undoStack.push(file.content);
                file.content = redoStack.pop();
                file.modified = file.content !== file.originalContent;

                const editorEl = document.getElementById('editor');
                if (editorEl) {
                    const scrollTop = editorEl.scrollTop;
                    editorEl.value = file.content;
                    editorEl.scrollTop = scrollTop;
                }

                this.updateLineNumbers();
                this.renderTabs();
                this.renderFileList();
                this.updateStatusBar();
            }

            cut() {
                document.execCommand('cut');
            }

            copy() {
                document.execCommand('copy');
            }

            paste() {
                document.execCommand('paste');
            }

            selectAll() {
                const editorEl = document.getElementById('editor');
                if (editorEl) {
                    editorEl.select();
                }
            }

            formatText(format) {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const start = editorEl.selectionStart;
                const end = editorEl.selectionEnd;
                const selectedText = editorEl.value.substring(start, end);

                if (!selectedText) return;

                let formattedText = selectedText;
                switch(format) {
                    case 'bold':
                        formattedText = `**${selectedText}**`;
                        break;
                    case 'italic':
                        formattedText = `*${selectedText}*`;
                        break;
                    case 'underline':
                        formattedText = `__${selectedText}__`;
                        break;
                }

                editorEl.setRangeText(formattedText, start, end, 'end');
                this.handleInput({target: editorEl});
            }

            changeFontSize(size) {
                const editorEl = document.getElementById('editor');
                if (editorEl) {
                    editorEl.style.fontSize = size + 'px';
                }
            }

            toggleSearch() {
                const panel = document.getElementById('searchPanel');
                const replaceRow = document.getElementById('replaceRow');
                
                panel.classList.toggle('active');
                replaceRow.style.display = 'none';
                
                if (panel.classList.contains('active')) {
                    document.getElementById('searchInput').focus();
                }
            }

            toggleReplace() {
                const panel = document.getElementById('searchPanel');
                const replaceRow = document.getElementById('replaceRow');
                
                panel.classList.add('active');
                replaceRow.style.display = 'flex';
                document.getElementById('searchInput').focus();
            }

            findNext() {
                const editorEl = document.getElementById('editor');
                const searchInput = document.getElementById('searchInput');
                
                if (!editorEl || !searchInput.value) return;

                const caseSensitive = document.getElementById('caseSensitive').checked;
                const useRegex = document.getElementById('useRegex').checked;
                
                let searchTerm = searchInput.value;
                let content = editorEl.value;
                let startPos = editorEl.selectionEnd;

                if (!caseSensitive && !useRegex) {
                    searchTerm = searchTerm.toLowerCase();
                    content = content.toLowerCase();
                }

                let index;
                if (useRegex) {
                    const regex = new RegExp(searchTerm, caseSensitive ? 'g' : 'gi');
                    const match = content.substring(startPos).match(regex);
                    index = match ? content.substring(startPos).search(regex) + startPos : -1;
                } else {
                    index = content.indexOf(searchTerm, startPos);
                }

                if (index === -1) {
                    // ì²˜ìŒë¶€í„° ë‹¤ì‹œ ê²€ìƒ‰
                    index = useRegex 
                        ? content.search(new RegExp(searchTerm, caseSensitive ? '' : 'i'))
                        : content.indexOf(searchTerm);
                }

                if (index !== -1) {
                    editorEl.focus();
                    editorEl.setSelectionRange(index, index + searchInput.value.length);
                    editorEl.scrollTop = editorEl.scrollHeight * (index / content.length);
                }
            }

            findPrevious() {
                const editorEl = document.getElementById('editor');
                const searchInput = document.getElementById('searchInput');
                
                if (!editorEl || !searchInput.value) return;

                const caseSensitive = document.getElementById('caseSensitive').checked;
                let searchTerm = searchInput.value;
                let content = editorEl.value;
                let startPos = editorEl.selectionStart - 1;

                if (!caseSensitive) {
                    searchTerm = searchTerm.toLowerCase();
                    content = content.toLowerCase();
                }

                const index = content.lastIndexOf(searchTerm, startPos);

                if (index !== -1) {
                    editorEl.focus();
                    editorEl.setSelectionRange(index, index + searchTerm.length);
                    editorEl.scrollTop = editorEl.scrollHeight * (index / content.length);
                }
            }

            replace() {
                const editorEl = document.getElementById('editor');
                const searchInput = document.getElementById('searchInput');
                const replaceInput = document.getElementById('replaceInput');
                
                if (!editorEl || !searchInput.value) return;

                const start = editorEl.selectionStart;
                const end = editorEl.selectionEnd;
                const selectedText = editorEl.value.substring(start, end);

                if (selectedText.toLowerCase() === searchInput.value.toLowerCase()) {
                    editorEl.setRangeText(replaceInput.value, start, end, 'end');
                    this.handleInput({target: editorEl});
                }

                this.findNext();
            }

            replaceAll() {
                const editorEl = document.getElementById('editor');
                const searchInput = document.getElementById('searchInput');
                const replaceInput = document.getElementById('replaceInput');
                
                if (!editorEl || !searchInput.value) return;

                const caseSensitive = document.getElementById('caseSensitive').checked;
                const useRegex = document.getElementById('useRegex').checked;

                let newContent;
                if (useRegex) {
                    const regex = new RegExp(searchInput.value, caseSensitive ? 'g' : 'gi');
                    newContent = editorEl.value.replace(regex, replaceInput.value);
                } else {
                    const regex = new RegExp(searchInput.value.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), caseSensitive ? 'g' : 'gi');
                    newContent = editorEl.value.replace(regex, replaceInput.value);
                }

                editorEl.value = newContent;
                this.handleInput({target: editorEl});
            }

            gotoLine() {
                const lineNumber = prompt('ì´ë™í•  ì¤„ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                if (!lineNumber) return;

                const editorEl = document.getElementById('editor');
                const lines = editorEl.value.split('\n');
                const targetLine = parseInt(lineNumber) - 1;

                if (targetLine < 0 || targetLine >= lines.length) {
                    alert('ìœ íš¨í•˜ì§€ ì•Šì€ ì¤„ ë²ˆí˜¸ì…ë‹ˆë‹¤.');
                    return;
                }

                let position = 0;
                for (let i = 0; i < targetLine; i++) {
                    position += lines[i].length + 1;
                }

                editorEl.focus();
                editorEl.setSelectionRange(position, position);
                editorEl.scrollTop = editorEl.scrollHeight * (position / editorEl.value.length);
            }

            indent() {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const start = editorEl.selectionStart;
                const end = editorEl.selectionEnd;
                const tabSize = parseInt(document.getElementById('tabSize').value) || 4;
                const tab = ' '.repeat(tabSize);

                if (start === end) {
                    editorEl.setRangeText(tab, start, end, 'end');
                } else {
                    const selectedText = editorEl.value.substring(start, end);
                    const indentedText = selectedText.split('\n').map(line => tab + line).join('\n');
                    editorEl.setRangeText(indentedText, start, end, 'end');
                }

                this.handleInput({target: editorEl});
            }

            outdent() {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const start = editorEl.selectionStart;
                const end = editorEl.selectionEnd;
                const tabSize = parseInt(document.getElementById('tabSize').value) || 4;

                const selectedText = editorEl.value.substring(start, end);
                const outdentedText = selectedText.split('\n').map(line => {
                    for (let i = 0; i < tabSize; i++) {
                        if (line.startsWith(' ')) {
                            line = line.substring(1);
                        } else {
                            break;
                        }
                    }
                    return line;
                }).join('\n');

                editorEl.setRangeText(outdentedText, start, end, 'end');
                this.handleInput({target: editorEl});
            }

            duplicateLine() {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const start = editorEl.selectionStart;
                const content = editorEl.value;
                const lineStart = content.lastIndexOf('\n', start - 1) + 1;
                const lineEnd = content.indexOf('\n', start);
                const line = content.substring(lineStart, lineEnd === -1 ? content.length : lineEnd);

                editorEl.setRangeText('\n' + line, lineEnd === -1 ? content.length : lineEnd, lineEnd === -1 ? content.length : lineEnd, 'end');
                this.handleInput({target: editorEl});
            }

            deleteLine() {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const start = editorEl.selectionStart;
                const content = editorEl.value;
                const lineStart = content.lastIndexOf('\n', start - 1) + 1;
                const lineEnd = content.indexOf('\n', start);

                if (lineEnd === -1) {
                    editorEl.setRangeText('', lineStart === 0 ? 0 : lineStart - 1, content.length, 'end');
                } else {
                    editorEl.setRangeText('', lineStart, lineEnd + 1, 'end');
                }

                this.handleInput({target: editorEl});
            }

            moveLinesUp() {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const start = editorEl.selectionStart;
                const content = editorEl.value;
                const lines = content.split('\n');
                
                let lineStart = content.lastIndexOf('\n', start - 1) + 1;
                let currentLineIndex = content.substring(0, lineStart).split('\n').length - 1;

                if (currentLineIndex === 0) return;

                const temp = lines[currentLineIndex];
                lines[currentLineIndex] = lines[currentLineIndex - 1];
                lines[currentLineIndex - 1] = temp;

                editorEl.value = lines.join('\n');
                
                const newPos = start - lines[currentLineIndex].length - 1;
                editorEl.setSelectionRange(newPos, newPos);
                
                this.handleInput({target: editorEl});
            }

            moveLinesDown() {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const start = editorEl.selectionStart;
                const content = editorEl.value;
                const lines = content.split('\n');
                
                let lineStart = content.lastIndexOf('\n', start - 1) + 1;
                let currentLineIndex = content.substring(0, lineStart).split('\n').length - 1;

                if (currentLineIndex === lines.length - 1) return;

                const temp = lines[currentLineIndex];
                lines[currentLineIndex] = lines[currentLineIndex + 1];
                lines[currentLineIndex + 1] = temp;

                editorEl.value = lines.join('\n');
                
                const newPos = start + lines[currentLineIndex].length + 1;
                editorEl.setSelectionRange(newPos, newPos);
                
                this.handleInput({target: editorEl});
            }

            updateCursorPosition() {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const position = editorEl.selectionStart;
                const content = editorEl.value.substring(0, position);
                const lines = content.split('\n');
                const line = lines.length;
                const col = lines[lines.length - 1].length + 1;

                document.getElementById('cursorPosition').textContent = `ì¤„ ${line}, ì—´ ${col}`;
            }

            updateStats() {
                const editorEl = document.getElementById('editor');
                if (!editorEl) return;

                const content = editorEl.value;
                const selectedText = content.substring(editorEl.selectionStart, editorEl.selectionEnd);

                document.getElementById('charCount').textContent = content.length.toLocaleString();
                document.getElementById('charNoSpace').textContent = content.replace(/\s/g, '').length.toLocaleString();
                document.getElementById('wordCount').textContent = content.trim() ? content.trim().split(/\s+/).length.toLocaleString() : '0';
                document.getElementById('lineCount').textContent = content.split('\n').length.toLocaleString();
                document.getElementById('selectedChars').textContent = selectedText.length.toLocaleString();
                document.getElementById('selection').textContent = `ì„ íƒ ${selectedText.length}`;
            }

            updateStatusBar() {
                if (this.currentFileIndex === -1) {
                    document.getElementById('fileInfo').textContent = 'íŒŒì¼ ì—†ìŒ';
                    document.getElementById('fileSize').textContent = '0 bytes';
                } else {
                    const file = this.files[this.currentFileIndex];
                    document.getElementById('fileInfo').textContent = file.name;
                    document.getElementById('fileSize').textContent = this.formatFileSize(file.size);
                }
                
                this.updateCursorPosition();
            }

            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' bytes';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
            }

            toggleSettings() {
                event.stopPropagation();
                const panel = document.getElementById('settingsPanel');
                panel.classList.toggle('active');
                document.getElementById('statsPanel').classList.remove('active');
            }

            toggleStats() {
                event.stopPropagation();
                const panel = document.getElementById('statsPanel');
                panel.classList.toggle('active');
                document.getElementById('settingsPanel').classList.remove('active');
                if (panel.classList.contains('active')) {
                    this.updateStats();
                }
            }

            updateSettings() {
                const showLineNumbers = document.getElementById('showLineNumbers').checked;
                const tabSize = document.getElementById('tabSize').value;
                const wordWrap = document.getElementById('wordWrap').checked;

                const lineNumbers = document.getElementById('lineNumbers');
                const editorEl = document.getElementById('editor');

                if (lineNumbers) {
                    lineNumbers.style.display = showLineNumbers ? 'block' : 'none';
                }

                if (editorEl) {
                    editorEl.style.tabSize = tabSize;
                    editorEl.style.whiteSpace = wordWrap ? 'pre-wrap' : 'pre';
                }
            }

            changeTheme(theme) {
                if (theme === 'light') {
                    document.body.style.background = '#ffffff';
                    document.body.style.color = '#000000';
                    // ì¶”ê°€ í…Œë§ˆ ë³€ê²½ ë¡œì§
                } else {
                    document.body.style.background = '#1e1e1e';
                    document.body.style.color = '#d4d4d4';
                }
            }

            showContextMenu(x, y) {
                const menu = document.getElementById('contextMenu');
                menu.style.left = x + 'px';
                menu.style.top = y + 'px';
                menu.classList.add('active');
            }

            hideContextMenu() {
                document.getElementById('contextMenu').classList.remove('active');
            }

            showNotification(message) {
                // ê°„ë‹¨í•œ ì•Œë¦¼ í‘œì‹œ
                const notification = document.createElement('div');
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    bottom: 60px;
                    right: 20px;
                    background: #0e639c;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 4px;
                    z-index: 3000;
                    animation: fadeInOut 2s ease-in-out;
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 2000);
            }
        }

        // ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0%, 100% { opacity: 0; transform: translateY(10px); }
                10%, 90% { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);

        // ì—ë””í„° ì´ˆê¸°í™”
        const editor = new TextEditor();
    </script>
</body>
</html>
